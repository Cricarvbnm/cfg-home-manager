# Home-Manager Configuration

This repository includes the versions of standalone and nixos modules.

In fact, this is not a flake (can be). Use flake to manage inputs,
but use [unflake](https://codeberg.org/goldstein/unflake) to emulate a flake
(manage and pin inputs)
and use [nh](https://github.com/nix-community/nh) to switch the configuration.

## Usage

**Update inputs:**

```shell
unflake
```

Unflake reads `inputs.nix`, which is inputs in `flake.nix` without `self`,
to generate `unflake.nix` (like flake.lock).

**Switch configuration:**

```shell
nh home switch
```

In normal home configurations,
nh evaluates `<home-manager/home-manager/home-manager.nix>` by

```shell
nh home switch -f "<home-manager/home-manager/home-manager.nix>" -- \
--arg confPath /path/to/home.nix ...
```

In this configuration,
nh evaluates `home-entry.nix` by

```shell
# Already set these variables in configuration
# export NIX_FILE=/path/to/home-entry.nix
# export NIX_ATTRP=homeConfigurations.${username}

nh home switch
```

`username` needs to be set in `info.nix`.

## Files

### Shared

**Can be customized:**

- `info.nix`: Custom information to configure the home.

- `shared.nix`: A home-manager module used in both modes (standalone and nixos module).

- `pkgs`: Custom packages.

- `users`: Modules for per-user settings.

- `modules`: Home settings.

### Standalone (for generic linux)

**Can be customized:**

- `flake.nix`: Provides custom packages and home configurations.
  Manages inputs.

- `home.nix`: Generic settings unrelated to input management.

- `hosts`: Host-related modules
  - `generic-linux`: modules for generic linux

**For bootstrap:**

- `home-entry.nix`: The entry exporting `outputs` in `flake.nix`
  through `unflake.nix`.

- `unflake.nix`: Generated by unflake, like flake.lock.
  Used to get inputs from `inputs.nix`.

- `inputs.nix`: Which removes `self` from `inputs` in `flake.nix`.

### NixOS Module

**Can be customized:**

- `default.nix`: The entry, only works as nixos module without flake.

## Deployment

### Standalone

Channels:

- `nixpkgs`: https://channels.nixos.org/nixos-25.11

Commands:

```shell
nix-shell -p nh
nh home switch --file ./home-entry.nix homeConfigurations.$USER
```

### NixOS Module

Add `imports = [ ./path/to/this/repository ]` into your `configuration.nix`
and rebuild the NixOS.
